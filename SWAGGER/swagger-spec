openapi: 3.0.1
info:
  title: URL SHORTENER - V2 API
  description: 'URL Shortener API. Read more about the [URL SHORTENER](https://confluence.manulife.io/display/Engineering/URL+Shortener) in our confluence document repository.'
  termsOfService: uri:tos
  contact:
    email: tommy_forlini@manulife.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 2.X
externalDocs:
  description: Find out more about URL Shortener
  url: https://confluence.manulife.io/display/Engineering/URL+Shortener
servers:
- url: https://go-dev.manulife.com
  description: Preview
- url: https://go.manulife.com
  description: Operations
tags:
- name: url
  description: Everything about shortend urls
  externalDocs:
    description: Find out more
    url: uri:description
paths:

  /{id}:
    get:
      tags:
      - url
      summary: Redirect by ID
      description: Find longurl by ID and redirect to it 
      operationId: RouterEndpoint
      parameters:
      - name: id
        in: path
        description: ID of longurl to redirect to
        required: true
        schema:
          type: string
      responses:
        307:
          description: Redirect
          content:
             application/html: {}
        404:
          description: ID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v2:
    get:
      tags:
      - url
      summary: Find all
      description: Returns 0..* objects defined in storage
      operationId: FindAllEndpoint
      parameters: []
      responses:
        200:
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlArray'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
      - url
      summary: Shorten a URL
      operationId: InsertEndpoint
      requestBody:
        description: Use autogenerated id or optionally supply a custom id
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UrlPost'
        required: true
      responses:
        201:
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlPostResponse'
        400:
          description: Missing longurl or invalid format longurl
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        409:
          description: Duplicate ID found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/v2/{id}:
    get:
      tags:
      - url
      summary: Find a URL by ID
      description: Find url details
      operationId: FindOneEndpoint
      parameters:
      - name: id
        in: path
        description: ID of url to search for
        required: true
        schema:
          type: string
      responses:
        200:
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Url'
        400:
          description: Missing ID supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: ID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


    put:
      tags:
      - url
      summary: Update a URL by ID
      operationId: UpdateEndpoint
      parameters:
      - name: id
        in: path
        description: ID of url to search for
        required: true
        schema:
          type: string
      requestBody:
        description: Attempt to update by id
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UrlPut'
        required: true
      responses:
        202:
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlPutResponse'
        400:
          description: Missing longurl or invalid format longurl
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: ID not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


        
components:
  schemas:
    Url:
      type: object
      properties:
        id:
          type: string
          example: google
        longurl:
          type: string
          example: http[s]://[www.]google.com
        createdAt:
          type: string
          example: yyyy-mm-ddThh:mm:ss.mmm+00:00
          description: Always in UTC
        createdBy:
          type: string
          example: SYSTEM
        updatedAt:
          type: string
          example: yyyy-mm-ddThh:mm:ss.mmm+00:00
          description: Always in UTC
        updatedBy:
          type: string
          example: SYSTEM
    UrlArray:
      type: array
      description: Array of Url
      items:
        $ref: '#/components/schemas/Url'


    UrlPost:
      type: object
      required: 
        - longurl
      properties:
        id:
          type: string
          example: google
        longurl:
          type: string
          example: http[s]://[www.]google.com
    UrlPostResponse:
      type: object
      properties:
        id:
          type: string
          example: google
        longurl:
          type: string
          example: http[s]://[www.]google.com
        createdAt:
          type: string
          example: yyyy-mm-ddThh:mm:ss.mmm+00:00
          description: Always in UTC
        createdBy:
          type: string
          example: SYSTEM

    UrlPut:
      type: object
      required: 
        - longurl
      properties:
        longurl:
          type: string
          example: http[s]://[www.]google.com
    UrlPutResponse:
      type: object
      properties:
        id:
          type: string
          example: google
        longurl:
          type: string
          example: http[s]://[www.]google.com
        updateddAt:
          type: string
          example: yyyy-mm-ddThh:mm:ss.mmm+00:00
          description: Always in UTC
        updateddBy:
          type: string
          example: SYSTEM

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
