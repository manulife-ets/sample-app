import http from "k6/http";
import { check, sleep } from "k6";

const baseURL = "https://go-dev.manulife.com/api/v2";

export default function() {

  // Create an Object containing the form data
  let formdata = {
    longurl: "https://k6-fake-url-post-test.com"
  };

  let params = {
    headers: { "Content-Type": "application/json" },
};

  // Autogenerated id
  let resPost = http.post(baseURL, JSON.stringify(formdata), params);
  let id = resPost.json().id
  check(resPost, {
    "status was 201": (r) => r.status == 201,
    "post transaction time OK": (r) => r.timings.duration < 200,
  });
  sleep(1)

  let resGet = http.get(baseURL + "/" + id);
  check(resGet, {
    "status was 200": (r) => r.status == 200,
    "get transaction time OK": (r) => r.timings.duration < 200,
    "longURL was OK": (r) => r.json().longurl === "https://k6-fake-url-post-test.com"
  });
  sleep(1);

  let resPut = http.put(baseURL + "/" + id, JSON.stringify(formdata), params);
  check(resPut, {
    "status was 202": (r) => r.status == 201,
    "post transaction time OK": (r) => r.timings.duration < 200,
  });
  sleep(1)

}
